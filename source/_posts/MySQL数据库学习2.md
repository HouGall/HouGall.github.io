---
title: MySQL数据库学习2
data: 2020-8-23 10:50:18
tags:
 - 数据库
 - 求职
categories:
 - 求职
mathjax: true
---
# 索引
>是一种数据库中进行查询的数据结构，常见的索引结构有**B树，B+树，哈希**。
## 为什么要用索引
>1.可以大大加快查询速度。
>2.无序的数据变为有序数据。
## 缺点
>占用物理存储空间。
>创建和维护索引耗费时间。
## B树和B+树
>B树每个节点存储数据，而B+树只有叶子节点存储数据。
>B树叶子节点是独立的，B+树相邻叶子节点连接。
>B+树检索稳定，B树不稳定。
## hash
>hash索引就是指哈希表，优点是根据哈希算法，就可以很快定位到数据，但是存在哈希碰撞的问题，并且不支持范围索引。
# 一条sql语句执行很慢是什么原因
>主要分为两个不同方向进行讨论.
>>1.大多数情况下是正常的，只有少数时间慢。
>>2.在数据量不变的情况下，一直都很慢。
## 大多数情况是正常的，少数时间很慢。
>这种情况下，sql语句本身没有错误，那么出现这种情况就只能是数据库问题了。
>>1.**==数据库在刷新脏页 #F44336==**。数据库在插入或更新数据时，数据库会现在内存中更新相应的字段，更新完内存字段后，它**不会**立即将内存中的数据同步到磁盘中，而是会将本次更新的记录**写到redo log**中，等到空闲时间再将内存数据同步到磁盘。**脏页就是内存数据页与磁盘数据页内容不一致的这一页**。、
>>>刷新脏页有以下几种情形（**==前两种会造成执行sql语句慢 #F44336==**）：
>>>1.**redo log写满了**。redo log的容量也是有限制的。当数据库遇到不断地更新时，redo log一直在被写入，很快就被写满了，此时数据库会停止内存更新，转到同步内存数据和磁盘数据，而**这个时候如果执行sql语句，就会变得很慢。**
>>>2.**内存不够用了**。如果查询的数据页不在内存中，那么数据库就需要先申请内存，然后将磁盘数据页读到内存中，如果**此时内存不足不够申请，那么就需要淘汰内存中的一些数据页**，如果时干净页就直接释放，但是**如果是脏页，就需要刷新脏页**。
>>>3.数据库认为系统处于空闲状态。
>>>4.数据库正常关闭，为了下次启动快，会在关闭前进行同步数据。
>>
>>2.**==执行的sql语句正好被其他事务加了锁，导致需要等待其他事务释放锁后才能数据访问 #F44336==**。可使用show processlist查询当前状态。

## sql语句一直执行很慢。
>这种情况可能是自己的sql语句写的不规范。
>1.**==没有用到索引 #F44336==**。
>>1.字段没有建立索引，所以慢。
>>2.字段建立了索引，但是没有使用，所以慢。比如对查询字段左边做了运算或者使用了函数操作，select * from t where c - 1 = 1000;正确的应该是select * from t where c  = 1000+1;
>
>2.数据库选错了索引。
>>数据库查询的时候可以使用 **==主键索引和 非主键索引#F44336 #F44336==** 。在**主键索引（和聚簇索引相似）** 的时候，B+树的叶子节点存储的数据内容，根据主键索引可以直接读取到数据。而在**非主键（和非聚簇索引相似）** 的时候，叶子节点存储的是主键的值，查询到符合的数据时，数据库会采样进行判断是采用查到的主键进行回表访问数据还是直接顺序查找表访问数据，判断哪个快就选哪个，**由于是采样的方式，那么数据库就会有判断错误的情况**。

# MySQL大表优化
>当表中的数据达到一定量时，数据库的CRUD就会非常慢，此时可医材与一些策略。
### 1.限定范围
>对要访问的数据采用一定的范围限制的查询语句，比如再查询历史订单时，控制在一个月以内。
### 2.读写分离
>使用主从库，主库负责写入，从库负责读。
### 垂直分区
>对表中的数据按**列**进行分离，形成多个表。
>优点：减小表中数据的大小，查询快，I/O少,易于维护。
>缺点：主键大量冗余，让事务更加复杂。
### 水平分区
>也是进行分表，但是时对**行**进行分离，形成分片，分片存储在不同的表或者库中。

# 池化设计思想、连接池
>池化思想就是初始化预设的资源，抵消每次获取资源的消耗，如创建线程的开销，建立远程连接的开销。
>连接池可以看作是维护数据库连接的缓存，以便将来重新需要时就可以在连接池中重用。**用户建立的连接会放置在连接池中，下次使用就不必建立新的连接**。

# 如何存储时间
>切记不能用字符串存储（占用空间太多）
>主要有三个：
>1.**datetime**：
>>1.无时区
>>2.耗费空间更大，需要八个字节，但是表示范围更大。
>
>2.**timestamp**：
>>1.有时区
>>2.耗费空较小，四个字节，但是表示范围小。
>
>3.**时间戳**：
>>1.可读性差。
>>2.具有timestamp的一些优点。

# MySQL读写分离，主从复制
>读写分离是为了**均衡负载**，建立主库和从库，主库用来写数据，从库用来读数据，因为写数据较慢，而读数据必须等到写数据完成后释放锁才能进行，所以建立读写分离可以加快检索时间。
>主库和从库需要保持数据一致，就需要主从复制进行，下面是具体步骤：
>>1.**主库**更新数据，将更新记录**写到**二进制日志**bin-log(binary-log)**。
>>2.**从库**创建一个**请求**I/O线程到主库，请求发送更新日志bin-log。
>>3.**主库**创建一个发送I/O线程，**发送**日志给从库。
>>4.**从库接收**日志并将其内容**写入**本地的**relay-log**。
>>5.**从库**创建一个**SQL线程**，读入relay-log内容，从Exec_Master_Log_Pos（记录位置）位置开始**更新**从数据库。